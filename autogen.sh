#! /bin/sh

autoreconf -v -f --install "$(dirname "$0")" || exit 1

CFLAGS="-O2"
CFLAGS="$CFLAGS -Wall"
CFLAGS="$CFLAGS -Wextra"
CFLAGS="$CFLAGS -Werror=char-subscripts"
CFLAGS="$CFLAGS -Werror=duplicate-decl-specifier"
CFLAGS="$CFLAGS -Werror=format"
CFLAGS="$CFLAGS -Wno-error=format-zero-length"  # no-error
CFLAGS="$CFLAGS -Werror=format-contains-nul"
CFLAGS="$CFLAGS -Werror=format-contains-nul"
CFLAGS="$CFLAGS -Werror=format-extra-args"
CFLAGS="$CFLAGS -Werror=format-overflow=2"
CFLAGS="$CFLAGS -Werror=format-security"
CFLAGS="$CFLAGS -Werror=format-signedness"
CFLAGS="$CFLAGS -Werror=format-truncation=1"
CFLAGS="$CFLAGS -Werror=nonnull"
CFLAGS="$CFLAGS -Werror=nonnull-compare"
CFLAGS="$CFLAGS -Werror=null-dereference"
CFLAGS="$CFLAGS -Werror=infinite-recursion"
CFLAGS="$CFLAGS -Werror=init-self"
CFLAGS="$CFLAGS -Werror=implicit-int"
CFLAGS="$CFLAGS -Werror=implicit-function-declaration"
CFLAGS="$CFLAGS -Werror=implicit-fallthrough=5"
CFLAGS="$CFLAGS -Werror=if-not-aligned"
CFLAGS="$CFLAGS -Werror=ignored-qualifiers"
CFLAGS="$CFLAGS -Werror=ignored-attributes"
CFLAGS="$CFLAGS -Werror=main"
CFLAGS="$CFLAGS -Werror=misleading-indentation"
CFLAGS="$CFLAGS -Werror=missing-attributes"
CFLAGS="$CFLAGS -Werror=missing-braces"
CFLAGS="$CFLAGS -Werror=mismatched-dealloc"
CFLAGS="$CFLAGS -Werror=multistatement-macros"
CFLAGS="$CFLAGS -Werror=parentheses"
CFLAGS="$CFLAGS -Werror=sequence-point"
CFLAGS="$CFLAGS -Werror=return-local-addr"
CFLAGS="$CFLAGS -Werror=return-type"
CFLAGS="$CFLAGS -Werror=shift-count-negative"
CFLAGS="$CFLAGS -Werror=shift-count-overflow"
CFLAGS="$CFLAGS -Werror=shift-negative-value"
CFLAGS="$CFLAGS -Werror=shift-overflow=2"
CFLAGS="$CFLAGS -Werror=switch"
CFLAGS="$CFLAGS -Werror=switch-enum"
CFLAGS="$CFLAGS -Werror=switch-bool"
CFLAGS="$CFLAGS -Werror=switch-outside-range"
CFLAGS="$CFLAGS -Werror=switch-unreachable"
CFLAGS="$CFLAGS -Werror=unused-but-set-parameter"
CFLAGS="$CFLAGS -Werror=unused-function"
CFLAGS="$CFLAGS -Werror=unused-label"
CFLAGS="$CFLAGS -Werror=unused-local-typedefs"
CFLAGS="$CFLAGS -Werror=unused-parameter"
CFLAGS="$CFLAGS -Werror=unused-variable"
CFLAGS="$CFLAGS -Werror=unused-const-variable=1"
CFLAGS="$CFLAGS -Werror=unused-value"
CFLAGS="$CFLAGS -Werror=use-after-free=3"
CFLAGS="$CFLAGS -Werror=uninitialized"
CFLAGS="$CFLAGS -Werror=invalid-memory-model"
CFLAGS="$CFLAGS -Werror=maybe-uninitialized"
CFLAGS="$CFLAGS -Werror=unknown-pragmas"
CFLAGS="$CFLAGS -Werror=pragmas"
CFLAGS="$CFLAGS -Werror=prio-ctor-dtor"
CFLAGS="$CFLAGS -Werror=strict-aliasing=3"
CFLAGS="$CFLAGS -Werror=strict-overflow=5"
CFLAGS="$CFLAGS -Werror=string-compare"
CFLAGS="$CFLAGS -Werror=stringop-overflow=4"
CFLAGS="$CFLAGS -Werror=stringop-truncation"
CFLAGS="$CFLAGS -Werror=alloc-size-larger-than=20999000"
CFLAGS="$CFLAGS -Werror=array-bounds=3"
CFLAGS="$CFLAGS -Werror=array-compare"
CFLAGS="$CFLAGS -Werror=array-parameter=2"
CFLAGS="$CFLAGS -Werror=bool-compare"
CFLAGS="$CFLAGS -Werror=bool-operation"
CFLAGS="$CFLAGS -Werror=duplicated-branches"
CFLAGS="$CFLAGS -Werror=duplicated-cond"
CFLAGS="$CFLAGS -Werror=frame-address"
CFLAGS="$CFLAGS -Werror=discarded-qualifiers"
CFLAGS="$CFLAGS -Werror=discarded-array-qualifiers"
CFLAGS="$CFLAGS -Werror=incompatible-pointer-types"
CFLAGS="$CFLAGS -Werror=int-conversion"
CFLAGS="$CFLAGS -Werror=tautological-compare"
CFLAGS="$CFLAGS -Werror=trampolines"
CFLAGS="$CFLAGS -Werror=larger-than=20999000"
CFLAGS="$CFLAGS -Werror=frame-larger-than=20000"
CFLAGS="$CFLAGS -Werror=free-nonheap-object"
CFLAGS="$CFLAGS -Werror=pointer-compare"
CFLAGS="$CFLAGS -Werror=type-limits"
CFLAGS="$CFLAGS -Werror=absolute-value"
CFLAGS="$CFLAGS -Werror=comment"
CFLAGS="$CFLAGS -Werror=trigraphs"
CFLAGS="$CFLAGS -Werror=endif-labels"
CFLAGS="$CFLAGS -Werror=cast-align=strict"
CFLAGS="$CFLAGS -Werror=cast-function-type"
CFLAGS="$CFLAGS -Werror=clobbered"
CFLAGS="$CFLAGS -Werror=dangling-pointer=2"
CFLAGS="$CFLAGS -Werror=date-time"
CFLAGS="$CFLAGS -Werror=empty-body"
CFLAGS="$CFLAGS -Werror=enum-compare"
CFLAGS="$CFLAGS -Werror=enum-conversion"
CFLAGS="$CFLAGS -Werror=jump-misses-init"
CFLAGS="$CFLAGS -Werror=sign-compare"
CFLAGS="$CFLAGS -Werror=scalar-storage-order"
CFLAGS="$CFLAGS -Werror=sizeof-array-div"
CFLAGS="$CFLAGS -Werror=sizeof-pointer-div"
CFLAGS="$CFLAGS -Werror=sizeof-pointer-memaccess"
CFLAGS="$CFLAGS -Werror=sizeof-array-argument"
CFLAGS="$CFLAGS -Werror=memset-elt-size"
CFLAGS="$CFLAGS -Werror=memset-transposed-args"
CFLAGS="$CFLAGS -Werror=address"
CFLAGS="$CFLAGS -Werror=address-of-packed-member"
CFLAGS="$CFLAGS -Werror=logical-op"
CFLAGS="$CFLAGS -Werror=logical-not-parentheses"
CFLAGS="$CFLAGS -Werror=aggregate-return"
CFLAGS="$CFLAGS -Werror=aggressive-loop-optimizations"
CFLAGS="$CFLAGS -Werror=attributes"
CFLAGS="$CFLAGS -Werror=builtin-declaration-mismatch"
CFLAGS="$CFLAGS -Werror=builtin-macro-redefined"
CFLAGS="$CFLAGS -Werror=missing-parameter-type"
CFLAGS="$CFLAGS -Werror=missing-field-initializers"
CFLAGS="$CFLAGS -Werror=multichar"
CFLAGS="$CFLAGS -Werror=normalized"
CFLAGS="$CFLAGS -Werror=attribute-warning"
CFLAGS="$CFLAGS -Werror=overflow"
CFLAGS="$CFLAGS -Werror=odr"
CFLAGS="$CFLAGS -Werror=override-init"
CFLAGS="$CFLAGS -Werror=override-init-side-effects"
CFLAGS="$CFLAGS -Werror=packed"
CFLAGS="$CFLAGS -Werror=packed-bitfield-compat"
CFLAGS="$CFLAGS -Werror=packed-not-aligned"
CFLAGS="$CFLAGS -Werror=restrict"
CFLAGS="$CFLAGS -Werror=nested-externs"
CFLAGS="$CFLAGS -Werror=int-in-bool-context"
CFLAGS="$CFLAGS -Werror=int-to-pointer-cast"
CFLAGS="$CFLAGS -Werror=pointer-to-int-cast"
CFLAGS="$CFLAGS -Werror=invalid-pch"
CFLAGS="$CFLAGS -Werror=varargs"
CFLAGS="$CFLAGS -Werror=vla-larger-than=20000"
CFLAGS="$CFLAGS -Werror=vla-parameter"
CFLAGS="$CFLAGS -Werror=volatile-register-var"
CFLAGS="$CFLAGS -Werror=pointer-sign"
CFLAGS="$CFLAGS -Werror=overlength-strings"
CFLAGS="$CFLAGS -Werror=designated-init"
CFLAGS="$CFLAGS -Wno-expansion-to-defined"
CFLAGS="$CFLAGS -Wno-unknown-attributes"
CFLAGS="$CFLAGS -Wno-unknown-warning-option"

"$(dirname "$0")"/configure \
	CFLAGS="$CFLAGS" \
	--enable-lastlog \
	--disable-logind \
	--enable-man \
	--enable-maintainer-mode \
	--enable-shared \
	--without-libpam \
	--with-selinux \
	"$@"
